# LifeBox IoT Platform - Environment Configuration Template
# Copy this file to .env and fill in your actual values
# üîê SECURITY: Never commit .env files to version control

# =============================================================================
# üöÄ PRODUCTION DEPLOYMENT CONFIGURATION
# =============================================================================

# VPS Configuration (Update with your actual VPS details)
VPS_PUBLIC_IP=YOUR_VPS_IP_ADDRESS
DOMAIN=YOUR_DOMAIN_OR_IP

# Database Configuration - Production PostgreSQL
DATABASE_URL="postgresql://lifebox_user:CHANGE_THIS_PASSWORD@postgres:5432/lifebox_prod?schema=public"
DB_USERNAME=lifebox_user
DB_PASSWORD=CHANGE_THIS_PASSWORD
DB_DATABASE=lifebox_prod

# Environment & API
NODE_ENV=production
PORT=3000
API_PORT=3000
API_PREFIX="api/v1"

# Production URLs (Replace with your actual domain)
FRONTEND_URL=https://your-domain.com
NEXT_PUBLIC_API_URL="https://your-domain.com/api/v1"
NEXT_PUBLIC_WS_URL="wss://your-domain.com"

# =============================================================================
# üîê SECURITY CONFIGURATION
# =============================================================================

# JWT Authentication - Generate secure random keys
JWT_SECRET="GENERATE_SECURE_256_BIT_KEY_HERE"
JWT_EXPIRATION="24h"
JWT_REFRESH_SECRET="GENERATE_DIFFERENT_256_BIT_KEY_HERE"
JWT_REFRESH_EXPIRATION="7d"

# EMQX Dashboard Configuration
EMQX_DASHBOARD_USER=admin
EMQX_DASHBOARD_PASSWORD=CHANGE_EMQX_PASSWORD

# Session Security
SESSION_SECRET="GENERATE_SESSION_SECRET_256_BIT_KEY"

# =============================================================================
# üì° MQTT BROKER CONFIGURATION
# =============================================================================

# Production MQTT Broker (Replace with your MQTT broker details)
MQTT_BROKER_HOST=your-mqtt-broker.com
MQTT_BROKER_PORT=8883                    # Use TLS port for production
MQTT_USERNAME=lifebox_production
MQTT_PASSWORD=CHANGE_THIS_MQTT_PASSWORD
MQTT_CLIENT_ID=lifebox-mqtt-prod

# Legacy MQTT (for backward compatibility)
MQTT_BROKER_URL="mqtts://your-mqtt-broker.com:8883"

# API Configuration for MQTT Service
API_BASE_URL=https://your-domain.com/api/v1
API_ADMIN_TOKEN=GENERATE_ADMIN_JWT_TOKEN_HERE
MQTT_API_TOKEN=GENERATE_MQTT_API_TOKEN_HERE
CONCURRENT_PROCESSING=10
API_TIMEOUT=30000

# MQTT Topics Configuration
MQTT_TELEMETRY_TOPIC="lifebox/devices/+/telemetry"
MQTT_STATUS_TOPIC="lifebox/devices/+/status"
MQTT_COMMAND_TOPIC="lifebox/devices/+/commands"
MQTT_ALARM_TOPIC="lifebox/devices/+/alarms"

# =============================================================================
# üì± SMS CONFIGURATION (Hybrid Routing)
# =============================================================================

# SMS Deployment Strategy
SMS_DEPLOYMENT_REGION=egypt              # egypt, international, global
SMS_FALLBACK_ENABLED=true
SMS_DOMESTIC_PROVIDER=vodafone
SMS_INTERNATIONAL_PROVIDER=twilio

# Vodafone SMS (Egyptian Provider)
VODAFONE_SMS_USERNAME=YOUR_VODAFONE_USERNAME
VODAFONE_SMS_PASSWORD=YOUR_VODAFONE_PASSWORD
VODAFONE_SMS_CUSTOMER_ID=YOUR_CUSTOMER_ID
VODAFONE_SMS_SENDER_ADDRESS=LIFEBOX      # Your approved sender name
VODAFONE_SMS_BASE_URL=https://api.messaging.vodafone.com
VODAFONE_SMS_NOTIFY_URL=https://your-domain.com/api/v1/notifications/vodafone/callback

# Twilio SMS (International Provider)
TWILIO_ACCOUNT_SID=AC_YOUR_ACCOUNT_SID
TWILIO_AUTH_TOKEN=YOUR_AUTH_TOKEN
TWILIO_PHONE_NUMBER=+1XXXXXXXXXX

# =============================================================================
# üìß EMAIL CONFIGURATION
# =============================================================================

# Production SMTP Configuration
SMTP_HOST="smtp.your-email-provider.com"
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER="noreply@your-domain.com"
SMTP_PASS="YOUR_EMAIL_PASSWORD"
SMTP_FROM="LifeBox IoT <noreply@your-domain.com>"
EMAIL_FROM="noreply@your-domain.com"

# Optional: SendGrid for better deliverability
SENDGRID_API_KEY=SG.YOUR_SENDGRID_API_KEY

# =============================================================================
# üí≥ FAWRY PAYMENT GATEWAY (Production)
# =============================================================================

# Fawry Production Configuration
FAWRY_BASE_URL="https://www.atfawry.com/fawryv2"
FAWRY_MERCHANT_CODE="YOUR_MERCHANT_CODE"
FAWRY_SECURITY_KEY="YOUR_FAWRY_SECURITY_KEY"
FAWRY_BILL_TYPE_CODE="YOUR_BILL_TYPE_CODE"
FAWRY_SKIP_SIGNATURE_VALIDATION=false    # MUST be false in production
FAWRY_WEBHOOK_URL="https://your-domain.com/api/v1/fawry/webhook"

# Credit Monitoring
CREDIT_WARNING_THRESHOLD=50              # EGP
CREDIT_CRITICAL_THRESHOLD=20             # EGP
CREDIT_MONITORING_INTERVAL=5             # minutes

# =============================================================================
# üìÅ FILE STORAGE & PATHS
# =============================================================================

REPORTS_PATH="/app/data/reports"
UPLOADS_PATH="/app/data/uploads"
TEMP_PATH="/app/data/temp"
MAX_FILE_SIZE=52428800                   # 50MB in bytes
UPLOAD_DIR="/app/data/uploads"
REPORT_TEMPLATE_PATH="/app/templates/reports"
REPORT_OUTPUT_PATH="/app/data/generated-reports"

# =============================================================================
# üìä MONITORING & LOGGING
# =============================================================================

# Logging Configuration
LOG_LEVEL="info"                         # error, warn, info (not debug in prod)
SENTRY_DSN="https://your-sentry-dsn@sentry.io/project-id"

# Rate Limiting
RATE_LIMIT_TTL=60
RATE_LIMIT_MAX=300                       # Higher limit for production

# Timezone
TZ="Africa/Cairo"

# =============================================================================
# ‚öôÔ∏è FEATURE FLAGS
# =============================================================================

ENABLE_EMAIL_NOTIFICATIONS=true
ENABLE_SMS_NOTIFICATIONS=true
ENABLE_AUTO_DEVICE_SHUTDOWN=true
ENABLE_AUTO_DEVICE_REACTIVATION=true
ENABLE_PAYMENT_RECONCILIATION=true

# Alarm Configuration
ALARM_EMAIL_ENABLED=true
ALARM_SMS_ENABLED=true
ALARM_COOLDOWN_MINUTES=15

# System User
SYSTEM_USER_EMAIL="system@your-domain.com"
SYSTEM_USER_ID="system"

# =============================================================================
# üè¢ COMPANY INTEGRATION SETTINGS
# =============================================================================

# These settings will be provided to companies for integration

# MQTT Broker Details (Share with companies)
COMPANY_MQTT_HOST=your-mqtt-broker.com
COMPANY_MQTT_PORT=8883
COMPANY_MQTT_TLS=true
COMPANY_MQTT_CERT_VALIDATION=true

# API Endpoints (Share with companies)
COMPANY_API_BASE=https://your-domain.com/api/v1
COMPANY_WEBSOCKET_URL=wss://your-domain.com

# Device Registration Endpoint
DEVICE_REGISTRATION_ENDPOINT=https://your-domain.com/api/v1/devices

# Telemetry Endpoint (HTTP fallback)
TELEMETRY_HTTP_ENDPOINT=https://your-domain.com/api/v1/devices/{deviceId}/telemetry

# =============================================================================
# üîß PRODUCTION OPTIMIZATIONS
# =============================================================================

# Database Connection Pool
DATABASE_POOL_SIZE=20
DATABASE_MAX_CONNECTIONS=100
DATABASE_CONNECTION_TIMEOUT=30000

# MQTT Connection Pool
MQTT_RECONNECT_PERIOD=5000
MQTT_KEEP_ALIVE=60
MQTT_CLEAN_SESSION=true

# Cache Configuration (if using Redis)
# REDIS_URL="redis://your-redis-host:6379"
# REDIS_PASSWORD="your-redis-password"

# =============================================================================
# ‚ö†Ô∏è SECURITY NOTES
# =============================================================================
# 1. Change all default passwords and secrets
# 2. Use environment-specific SSL certificates
# 3. Enable database SSL connections
# 4. Use secure MQTT connections (TLS)
# 5. Implement proper firewall rules
# 6. Regular security updates and monitoring
# 7. Backup strategy implementation
# 8. Monitor logs for suspicious activity

# =============================================================================
# üìã DEPLOYMENT CHECKLIST
# =============================================================================
# [ ] Database created and accessible
# [ ] MQTT broker configured and running
# [ ] SSL certificates installed
# [ ] DNS records configured
# [ ] Fawry payment gateway tested
# [ ] SMS providers tested
# [ ] Email delivery tested
# [ ] Monitoring and logging configured
# [ ] Backup procedures implemented
# [ ] Security scanning completed